<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Explorar</ion-title>
    
    <ion-buttons slot="end">
      <ion-button (click)="toggleFilters()">
        <ion-icon 
          [name]="showFilters ? 'filter' : 'filter-outline'" 
          slot="icon-only">
        </ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Explorar</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Barra de búsqueda -->
  <div class="search-container">
    <ion-searchbar
      [(ngModel)]="searchQuery"
      (ionInput)="onSearchInput()"
      placeholder="Buscar por nombre o alias..."
      animated
      debounce="500">
    </ion-searchbar>
  </div>

  <!-- Filtros -->
  <div class="filters-section" *ngIf="showFilters">
    <div class="filter-row">
      <ion-select 
        label="Universo" 
        [(ngModel)]="selectedUniverse"
        (ionChange)="onFilterChange()">
        <ion-select-option value="all">Todos</ion-select-option>
        <ion-select-option 
          *ngFor="let universe of universes" 
          [value]="universe">
          {{ universe }}
        </ion-select-option>
      </ion-select>

      <ion-select 
        label="Afiliación" 
        [(ngModel)]="selectedAffiliation"
        (ionChange)="onFilterChange()">
        <ion-select-option value="all">Todas</ion-select-option>
        <ion-select-option 
          *ngFor="let affiliation of affiliations" 
          [value]="affiliation">
          {{ affiliation }}
        </ion-select-option>
      </ion-select>
    </div>

    <div class="filter-row">
      <ion-select 
        label="Ordenar" 
        [(ngModel)]="sortBy"
        (ionChange)="onSortChange()">
        <ion-select-option value="name-asc">Nombre A-Z</ion-select-option>
        <ion-select-option value="name-desc">Nombre Z-A</ion-select-option>
        <ion-select-option value="rating-desc">Rating ↑</ion-select-option>
        <ion-select-option value="rating-asc">Rating ↓</ion-select-option>
      </ion-select>

      <ion-button 
        *ngIf="hasActiveFilters"
        fill="outline" 
        color="medium"
        (click)="clearFilters()">
        Limpiar
      </ion-button>
    </div>
  </div>

  <!-- Información de resultados -->
  <div class="results-info" *ngIf="!isLoading">
    {{ resultsCount }} {{ resultsCount === 1 ? 'resultado' : 'resultados' }}
    <span *ngIf="hasActiveFilters">(filtrados)</span>
  </div>

  <!-- Estados -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Cargando personajes...</p>
  </div>

  <div *ngIf="isSearching" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Buscando...</p>
  </div>

  <!-- Grid de personajes -->
  <div class="characters-grid" *ngIf="!isLoading && !isSearching">
    <app-character-card 
      *ngFor="let character of filteredCharacters"
      [character]="character"
      [isFavorite]="false"
      
      (cardClicked)="onCharacterClicked($event)">
    </app-character-card>

    <!-- Estado vacío -->
    <div *ngIf="filteredCharacters.length === 0" class="empty-state">
      <ion-icon name="search-outline" size="large"></ion-icon>
      <h3>No se encontraron personajes</h3>
      <p *ngIf="hasActiveFilters">Intenta ajustar los filtros</p>
      <ion-button 
        *ngIf="hasActiveFilters"
        fill="outline" 
        (click)="clearFilters()">
        Limpiar Filtros
      </ion-button>
    </div>
  </div>

  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshCharacters($event)">
  <ion-refresher-content
    pullingIcon="chevron-down-circle-outline"
    pullingText="Tira para actualizar"
    refreshingSpinner="circles"
    refreshingText="Actualizando...">
  </ion-refresher-content>
</ion-refresher>
</ion-content>