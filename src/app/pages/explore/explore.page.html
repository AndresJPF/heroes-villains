<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Explorar Heroes y Villanos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Search Bar -->
  <div class="search-section">
    <ion-searchbar
      [(ngModel)]="searchQuery"
      (ionInput)="onSearchInput()"
      placeholder="Buscar héroes y villanos..."
      animated
      clear-icon="close-circle"
    ></ion-searchbar>
  </div>

  <!-- Filters & Results Info -->
  <div class="controls-section">
    <div class="results-info">
      <span class="results-count">{{ resultsCount }} resultado{{ resultsCount !== 1 ? 's' : '' }}</span>
      
      <ion-button 
        fill="clear" 
        size="small" 
        (click)="toggleFilters()"
        class="filter-toggle"
      >
        <ion-icon name="filter" slot="start"></ion-icon>
        Filtros
      </ion-button>
    </div>

    <!-- Expanded Filters -->
    <div class="expanded-filters" *ngIf="showFilters">
      <div class="filter-row">
        <ion-item>
          <ion-select 
            [(ngModel)]="selectedUniverse" 
            (ionChange)="onFilterChange()"
            label="Universo"
            interface="popover"
          >
            <ion-select-option value="all">Todos los universos</ion-select-option>
            <ion-select-option *ngFor="let universe of universes" [value]="universe">
              {{ universe }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-select 
            [(ngModel)]="selectedAffiliation" 
            (ionChange)="onFilterChange()"
            label="Alineación"
            interface="popover"
          >
            <ion-select-option value="all">Todas las alineaciones</ion-select-option>
            <ion-select-option *ngFor="let affiliation of affiliations" [value]="affiliation">
              {{ affiliation }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="filter-row">
        <ion-item>
          <ion-select 
            [(ngModel)]="sortBy" 
            (ionChange)="onSortChange()"
            label="Ordenar por"
            interface="popover"
          >
            <ion-select-option value="name-asc">Nombre (A-Z)</ion-select-option>
            <ion-select-option value="name-desc">Nombre (Z-A)</ion-select-option>
            <ion-select-option value="rating-desc">Rating (Mayor a menor)</ion-select-option>
            <ion-select-option value="rating-asc">Rating (Menor a mayor)</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-button 
          fill="outline" 
          size="small" 
          (click)="clearFilters()"
          *ngIf="hasActiveFilters"
          class="clear-filters"
        >
          <ion-icon name="close" slot="start"></ion-icon>
          Limpiar
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner></ion-spinner>
    <p>Cargando personajes...</p>
  </div>

  <!-- Search Loading -->
  <div class="search-loading" *ngIf="isSearching && !isLoading">
    <ion-spinner></ion-spinner>
    <p>Buscando...</p>
  </div>

  <!-- Characters Grid -->
  <div class="characters-grid" *ngIf="!isLoading && !isSearching">
    <app-character-card
      *ngFor="let character of filteredCharacters"
      [character]="character"
      (cardClicked)="onCharacterClicked($event)"
      (favoriteToggled)="onFavoriteToggled($event)"
    ></app-character-card>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && !isSearching && filteredCharacters.length === 0">
    <ion-icon name="search-outline"></ion-icon>
    <h3>No se encontraron personajes</h3>
    <p>Intenta con otros términos de búsqueda o filtros</p>
    <ion-button (click)="clearFilters()" fill="outline">
      Limpiar búsqueda
    </ion-button>
  </div>

  <!-- Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshCharacters($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
</ion-content>